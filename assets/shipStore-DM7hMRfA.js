import{J as h,H as a}from"./index-CIabCGaw.js";const l=h("ship",{state:()=>({token:localStorage.getItem("wafatoken")?localStorage.getItem("wafatoken"):null,errors:[],holds:[],bls:[],sumBl:[],blByCategory:[],loading:!1,rapportDates:[],ships:[],url:"www.developpeur-junior.com/api"}),getters:{getToken:e=>e.token,getErrors:e=>e.errors,getLoading:e=>e.loading,getBlLength:e=>e.sumBl.length,getTotalMarchandise:e=>e.sumBl.reduce((t,s)=>t+s.sumTotal,0),getTotalMarchandiseOf:e=>e.sumBl.reduce((t,s)=>t+s.sumTotalOf,0)},actions:{csrf(){a.get("/sanctum/csrf-cookie")},async registerForm(e,t){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,await a.post(this.url+"/ship/store/"+e,t).then(s=>{s.status===200&&(this.loading=!1)}).catch(s=>{if(s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0])})},async getShips(){this.loading=!0,await this.csrf(),this.ships=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,await a.get(this.url+"/ships").then(e=>{e.status===200&&(this.loading=!1,this.ships=e.data.ships)}).catch(e=>{if(e.response.status===401)for(const t in e.response.data.errors)this.errors.push(e.response.data.errors[t][0])})},async updateShip(e,t){await this.csrf(),a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,await a.put(this.url+"/ship/update/"+e,t).then(s=>{s.status===200&&(this.loading=!1)}).catch(s=>{if(console.log(s),s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0]);s.response.status===404&&this.errors.push("probleme de connexion")})},async destroy(e){await this.csrf(),a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.delete(this.url+"/ship/delete/"+e).then(t=>{t.status==200&&(this.loading=!1)}).catch(t=>{window.location.href="/dashboard"})},async showShip(e){this.ships=[],this.holds=[],this.bls=[],await this.csrf(),a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,a.get(this.url+"/ship/show/"+e).then(t=>{t.status==200&&(this.loading=!1,this.ships=t.data.data[0],this.holds=t.data.data[0].holds,this.bls=t.data.data[0].bls)}).catch(t=>{window.location.href="/dashboard"})},async updateHold(e,t){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,await a.put(this.url+"/hold/update/"+e,t).then(s=>{s.status===200&&(this.loading=!1)}).catch(s=>{if(s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0]);s.response.status===404&&this.errors.push("probleme de connexion")})},async destroyHold(e){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.delete(this.url+"/hold/delete/"+e).then(t=>{t.status==200&&(this.loading=!1)}).catch(t=>{this.errors.push(t.response.data)})},async storeHold(e,t){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.post(this.url+"/hold/store/"+e,t).then(s=>{s.status==200&&(this.loading=!1)}).catch(s=>{if(s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0])})},async storeHoldHistory(e,t){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,await a.post(this.url+"/hold-history/store/"+e,t).then(s=>{s.status==200&&(this.loading=!1)}).catch(s=>{if(s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0])})},async destroyHoldHistory(e){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.delete(this.url+"/hold-history/delete/"+e).then(t=>{t.status==200&&(this.loading=!1)}).catch(t=>{this.errors.push(t.response.data)})},async storebl(e,t){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.post(this.url+"/bl/store/"+e,t,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{s.status==200&&(this.loading=!1)}).catch(s=>{if(console.log(s),s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0])})},async blAll(e){this.bls=[],this.sumBl=[],this.blByCategory=[],await this.csrf(),a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,a.get(this.url+"/bls/?search="+e).then(t=>{if(t.status==200){this.bls=t.data.data,this.bls.sort((o,r)=>o.marchandise.localeCompare(r.marchandise));const s=this.bls.reduce((o,r)=>(o[r.marchandise]||(o[r.marchandise]=[]),o[r.marchandise].push(r),o),{});this.blByCategory=Object.entries(s).map(([o,r])=>({marchandise:o,items:r})),this.sumByCategory(this.blByCategory)}}).catch(t=>{console.log(t)})},async sumByCategory(e){this.sumBl=[],e.length&&e.forEach(t=>{const s=t.items.reduce((r,i)=>i.date_reception!="non_recu"?r+i.tonnage_mt:r+0,0),o=t.items.reduce((r,i)=>i.date_reception=="non_recu"?r+i.tonnage_mt:r+0,0);this.sumBl.push({sumTotal:s,sumTotalOf:o,category:t.marchandise})})},async updatebl(e,t){await this.csrf(),this.errors=[],this.bls=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.put(this.url+"/bl/update/"+e,t).then(s=>{s.status==200&&(this.loading=!1)}).catch(s=>{if(s.response.status===401)for(const o in s.response.data.errors)this.errors.push(s.response.data.errors[o][0])})},async destroyBl(e){await this.csrf(),this.errors=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,this.loading=!0,a.delete(this.url+"/bl/delete/"+e).then(t=>{t.status==200&&(this.loading=!1)}).catch(t=>{this.errors.push(t.response.data)})},async storeRapportDate(e,t){await this.csrf(),a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,a.post(this.url+"/rapport/"+e,t).then(s=>{s.status==200&&(this.loading=!1)}).catch(s=>{console.log(s),this.errors.push(s.response.data)})},async rapportDateByShip(e){await this.csrf(),this.rapportDates=[],a.defaults.headers.common.Authorization=`Bearer ${this.getToken}`,a.get(this.url+"/rapport/?ship="+e).then(t=>{t.status==200&&(this.rapportDates=t.data.data)}).catch(t=>{console.log(t)})}}});export{l as u};
