import{u as F}from"./shipStore-C76Dcvx2.js";import{S as h,_ as N,a as z}from"./NavBar-PCZ1jSOO.js";import{q as j,r as C,o as m,c as _,a as t,t as n,F as H,p as A,g as O,e as R,A as L,C as U,u as q,x as k,k as S,b as p,n as V,d as M,y as G,z as J}from"./index-CV8vgmQs.js";import{F as K}from"./Footer-BYgE83Od.js";const P={class:"vertical-align"},Q={class:"p-2 border"},W={class:"ms-2 d-flex justify-content-between"},X={class:"float-right"},Y=["data-idhold"],Z=["data-name","data-category","data-tcargo","data-tdischarged","data-id"],tt=["data-holdname","data-holdid"],et={class:"p-2 border"},st={class:"p-2 border"},ot={class:"p-2 border"},at={class:"p-0 border"},lt={key:0},it=["data-historydischarged","data-historyid"],rt={__name:"CardHold",props:["hold","ship_id"],setup(b){const a=F(),o=b,e=C({name:"",category:"",tcargo:"",tdischarged:"",id:""}),g=C({discharged:0,history:"",id:""}),T=async i=>{const s=i.currentTarget.dataset.idhold;await h.fire({title:"ajouter rapport",html:`
    <label for="" class="form-label">decharger</label>
    <input type="number" id="swal-input6" step="0.001" class="form-control mb-2" value="">
    <label for="" class="form-label">date</label>
    <input type="date"   id="swal-input7" class="form-control mb-2" value="">
    <input type="hidden" id="swal-input8" class="swal2-input" value="${s}">
  `,showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonText:"Ajouter",allowOutsideClick:!1,focusConfirm:!1,preConfirm:()=>[g.discharged=document.getElementById("swal-input6").value,g.history=document.getElementById("swal-input7").value,g.id=document.getElementById("swal-input8").value]}),g.id&&E()},E=async()=>{await a.storeHoldHistory(g.id,g),a.getErrors.length||a.showShip(o.ship_id),a.getErrors.length&&setTimeout(()=>{h.fire({icon:"error",title:"Oops...",text:a.getErrors,allowOutsideClick:!1})},2e3)},v=async i=>{const s=i.currentTarget.dataset.name,l=i.currentTarget.dataset.category,f=i.currentTarget.dataset.tcargo,w=i.currentTarget.dataset.tdischarged,x=i.currentTarget.dataset.id,{value:I}=await h.fire({title:"Mofifier Hold",html:`
    <label for="" class="form-label">Nom du Hold</label>
    <input type="text" id="swal-input1" class="form-control mb-2" value="${s}">
    <label for="" class="form-label">category</label>
    <input type="text"   id="swal-input2" class="form-control mb-2" value="${l}">
    <label for="" class="form-label">Total cargo</label>
    <input type="number" step="0.001"  id="swal-input3" class="form-control mb-2" value="${f}">
    <label for="" class="form-label">Total decharger</label>
    <input type="number" step="0.001"  id="swal-input4" class="form-control mb-2" value="${w}">
    <input type="hidden" id="swal-input5" class="swal2-input" value="${x}">
  `,showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonText:"modifier",allowOutsideClick:!1,focusConfirm:!1,preConfirm:()=>[e.name=document.getElementById("swal-input1").value,e.category=document.getElementById("swal-input2").value,e.tcargo=document.getElementById("swal-input3").value,e.tdischarged=document.getElementById("swal-input4").value,e.id=document.getElementById("swal-input5").value]});I&&B()},B=async()=>{await a.updateHold(e.id,e),a.getErrors.length||a.showShip(o.ship_id),a.getErrors.length&&setTimeout(()=>{h.fire({icon:"error",title:"Oops...",text:a.getErrors,allowOutsideClick:!1})},2e3)},y=i=>{const s=i.currentTarget.dataset.holdid,l=i.currentTarget.dataset.holdname;h.fire({icon:"error",title:l,text:"Voulez-vous supprimer cet Hold ?",showCancelButton:!0,cancelButtonText:"Retour",confirmButtonText:"Oui",allowOutsideClick:!1}).then(async f=>{f.isConfirmed&&(await a.destroyHold(s),a.showShip(o.ship_id))})},$=i=>{const s=i.currentTarget.dataset.historyid,l=i.currentTarget.dataset.historydischarged;h.fire({icon:"error",title:l,text:"Voulez-vous supprimer ce rapport ?",showCancelButton:!0,cancelButtonText:"Retour",confirmButtonText:"Oui",allowOutsideClick:!1}).then(async f=>{f.isConfirmed&&(await a.destroyHoldHistory(s),a.showShip(o.ship_id))})};return(i,s)=>(m(),_("div",P,[t("div",Q,[t("strong",W,[t("span",null,n(o.hold.name)+"- "+n(o.hold.type),1),t("span",X,[t("i",{"data-idhold":o.hold.id,onClick:s[0]||(s[0]=l=>T(l)),class:"bi bi-clock-history mx-2 cursor-pointer"},null,8,Y),t("i",{"data-name":o.hold.name,"data-category":o.hold.type,"data-tcargo":o.hold.Total_cargo,"data-tdischarged":o.hold.Total_discharged,"data-id":o.hold.id,onClick:s[1]||(s[1]=l=>v(l)),class:"bx bx-edit-alt me-1 mx-2 cursor-pointer"},null,8,Z),t("i",{onClick:s[2]||(s[2]=l=>y(l)),"data-holdname":o.hold.name,"data-holdid":o.hold.id,class:"bx bx-trash me-1 mx-2 text-danger cursor-pointer"},null,8,tt)])])]),t("div",et,n(o.hold.Total_cargo),1),t("div",st,n(o.hold.Total_discharged),1),t("div",ot,n((o.hold.Total_cargo-o.hold.Total_discharged).toFixed(3)),1),t("div",at,[o.hold.holdHistories.length?(m(),_("div",lt,[(m(!0),_(H,null,A(o.hold.holdHistories,l=>(m(),_("p",{key:l.id,class:"card-text mt-0 mb-0 fs-6 border heighborder"},[O(n(l.discharged)+"      ",1),t("i",{onClick:s[3]||(s[3]=f=>$(f)),"data-historydischarged":l.discharged,"data-historyid":l.id,class:"bx bx-trash ms-3 text-danger cursor-pointer"},null,8,it)]))),128))])):R("",!0)])]))}},dt=j(rt,[["__scopeId","data-v-f24a6337"]]),d=b=>(G("data-v-bb6a0e63"),b=b(),J(),b),nt={class:"layout-wrapper layout-content-navbar"},ct={class:"layout-container"},ut={class:"layout-page"},pt={class:"content-wrapper"},ht={class:"row mt-3"},mt={class:"col-lg"},ft={class:"card mb-1"},_t={class:"card-header d-flex justify-content-between"},gt=d(()=>t("i",{class:"bi bi-plus"},null,-1)),bt=d(()=>t("i",{class:"bi bi-plus"},null,-1)),vt={class:"card-body"},yt={class:"row gy-3"},wt={class:"col-sm-4"},xt=d(()=>t("small",{class:"text-light fw-semibold"},"pourcentage",-1)),Ct={class:"demo-inline-spacing"},Tt={type:"button",class:"btn btn-primary"},Bt={class:"col-sm-2"},kt=d(()=>t("small",{class:"text-light fw-semibold"},"valider modification",-1)),Et={class:"demo-inline-spacing"},$t={class:"col-sm-2"},It=d(()=>t("small",{class:"text-light fw-semibold"},"Annuler modification",-1)),St={class:"demo-inline-spacing"},Ht={class:"col-sm-2"},At={class:"demo-inline-spacing"},Ot={class:"card"},Vt=d(()=>t("h5",{class:"card-header"},"Liste des Holds",-1)),Ft={class:"table-responsive text-nowrap"},jt={key:0,class:"mt-3 d-flex flex-row"},Rt={class:"vertical-align"},Dt=d(()=>t("div",{class:"p-2 border"},"Holds",-1)),Nt=d(()=>t("div",{class:"p-2 border"},"Total cargo",-1)),zt=d(()=>t("div",{class:"p-2 border"},"Total discharged",-1)),Lt=d(()=>t("div",{class:"p-2 border"},"Remaining on board",-1)),Ut={class:"p-2 border"},qt={class:"vertical-align"},Mt=d(()=>t("div",{class:"p-2 border"},"Total",-1)),Gt={class:"p-2 border"},Jt={class:"p-2 border"},Kt={class:"p-2 border"},Pt=d(()=>t("div",{class:"content-backdrop fade"},null,-1)),Qt=d(()=>t("div",{class:"layout-overlay layout-menu-toggle"},null,-1)),Wt={__name:"ShipView",setup(b){const a=L(),o=U(),e=F(),g=q(),{showShip:T,rapportDateByShip:E}=e;T(a.params.id),E(a.params.id);const v=C({confirmed:!1,id:""}),B=async c=>{const r=c.currentTarget.dataset.validate=="true";c.currentTarget.dataset.iduser,v.confirmed=r,v.id=e.ships.id,await g.activeUser(v.id,v),T(a.params.id)},y=C({rapport:"",id:""}),$=async()=>{const{value:c}=await h.fire({title:"Ajouter date de rapport",html:`
    <label  class="form-label" >date(*)</label>               
    <input type="date" id="swal-input6" class="form-control mb-2" value="" >
     <input type="hidden" id="swal-input7" class="swal2-input" value="${e.ships.id}">
  `,showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonText:"Ajouter",allowOutsideClick:!1,focusConfirm:!1,preConfirm:()=>[y.rapport=document.getElementById("swal-input6").value,y.id=document.getElementById("swal-input7").value]});c&&i()},i=async()=>{await e.storeRapportDate(y.id,y),e.getErrors.length||(e.showShip(e.ships.id),e.rapportDateByShip(a.params.id)),e.getErrors.length&&setTimeout(()=>{h.fire({icon:"error",title:"Oops...",text:e.getErrors,allowOutsideClick:!1})},2e3)},s=C({name:"",category:"",tcargo:"",tdischarged:"",shipId:""}),l=async()=>{const{value:c}=await h.fire({title:"Ajouter Hold",html:`
    <label  class="form-label" >name(*)</label>               
    <input type="text" id="swal-input1" class="form-control mb-2" value="" placeholder="hold name">
    <input type="text"   id="swal-input2" class="form-control mb-2" value="" placeholder="category">
    <label  class="form-label" >total cargo(*)</label>
    <input type="number" step="0.001"  id="swal-input3" class="form-control mb-2" value="" placeholder="total cargo">
    <label  class="form-label" >total decharger(*)</label>
    <input type="number" step="0.001"  id="swal-input4" class="form-control mb-2" value="" placeholder="total decharger">
    <input type="hidden" id="swal-input5" class="swal2-input" value="${e.ships.id}">
  `,showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonText:"Ajouter",allowOutsideClick:!1,focusConfirm:!1,preConfirm:()=>[s.name=document.getElementById("swal-input1").value,s.category=document.getElementById("swal-input2").value,s.tcargo=document.getElementById("swal-input3").value,s.tdischarged=document.getElementById("swal-input4").value,s.shipId=document.getElementById("swal-input5").value]});c&&f()},f=async()=>{await e.storeHold(s.shipId,s),e.getErrors.length||e.showShip(s.shipId),e.getErrors.length&&setTimeout(()=>{h.fire({icon:"error",title:"Oops...",text:e.getErrors,allowOutsideClick:!1})},2e3)},w=k(()=>e.holds.reduce((c,r)=>c+r.Total_cargo,0).toFixed(3)),x=k(()=>e.holds.reduce((c,r)=>c+r.Total_discharged,0).toFixed(3)),I=k(()=>(w.value-x.value).toFixed(3)),D=k(()=>w.value>0?(x.value*100/w.value).toFixed(2):0);return(c,r)=>(m(),_("div",nt,[t("div",ct,[S(N),t("div",ut,[S(z),t("div",pt,[t("div",ht,[t("div",mt,[t("div",ft,[t("h5",_t,[t("span",null,n(p(e).ships.name),1),t("span",{onClick:r[0]||(r[0]=u=>$()),class:"cursor-pointer"},[gt,O("date rapport")]),t("span",{onClick:r[1]||(r[1]=u=>l()),class:"cursor-pointer"},[bt,O("hold")])]),t("div",vt,[t("div",yt,[t("div",wt,[xt,t("div",Ct,[t("button",Tt,n(D.value)+"% ",1)])]),t("div",Bt,[kt,t("div",Et,[t("button",{onClick:r[2]||(r[2]=u=>B(u)),"data-validate":"true",class:V({"btn btn-success":p(e).ships.confirmed,"btn btn-outline-primary":!p(e).ships.confirmed}),type:"button"}," Valider ",2)])]),t("div",$t,[It,t("div",St,[t("button",{onClick:r[3]||(r[3]=u=>B(u)),"data-validate":"false",type:"button",class:V({"btn btn-success":!p(e).ships.confirmed,"btn btn-outline-primary":p(e).ships.confirmed})}," Annuler ",2)])]),t("div",Ht,[t("div",At,[t("button",{onClick:r[4]||(r[4]=u=>p(o).back()),type:"button",class:"btn btn-dark"}," Retour ")])])])])])]),t("div",Ot,[Vt,t("div",Ft,[p(e).holds.length?(m(),_("div",jt,[t("div",Rt,[Dt,Nt,zt,Lt,(m(!0),_(H,null,A(p(e).rapportDates,u=>(m(),_("div",Ut,n(u.rapport),1))),256))]),(m(!0),_(H,null,A(p(e).holds,u=>(m(),M(dt,{key:u.id,hold:u,ship_id:p(e).ships.id},null,8,["hold","ship_id"]))),128)),t("div",qt,[Mt,t("div",Gt,n(w.value),1),t("div",Jt,n(x.value),1),t("div",Kt,n(I.value),1)])])):R("",!0)])])]),S(K),Pt])])]),Qt]))}},ee=j(Wt,[["__scopeId","data-v-bb6a0e63"]]);export{ee as default};
